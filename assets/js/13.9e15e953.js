(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{413:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"「c-c-语言」中对负数的左移与右移浅析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#「c-c-语言」中对负数的左移与右移浅析"}},[s._v("#")]),s._v(" 「C/C++ 语言」中对负数的左移与右移浅析")]),s._v(" "),t("h2",{attrs:{id:"demo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[s._v("#")]),s._v(" Demo")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("小组今年的面试题有一道题目专门考了 "),t("code",[s._v("UB")]),s._v(" 行为，所以最近就对 UB 行为比较感兴趣，发现关于这方面确实是自己一直以来遗漏掉的一个地方。")])]),s._v(" "),t("li",[t("p",[s._v("在另一道面试题中，考到了负数的位移"),t("code",[s._v("位运算")]),s._v("，关于负数的左移与右移到底属于什么行为引出了一些讨论。")])]),s._v(" "),t("li",[t("p",[s._v("原题如下")])])]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("short")]),s._v(" d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("signed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" e "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    e "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a:%d , b:%d , c:%d , d:%d\\n"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"e:%#x\\n"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ul",[t("li",[s._v("题目的题解在此就不展开了，这篇博客主要讨论一下负数的左移与右移")])]),s._v(" "),t("h2",{attrs:{id:"参阅标准"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参阅标准"}},[s._v("#")]),s._v(" 参阅标准")]),s._v(" "),t("h3",{attrs:{id:"iso-iec-9899"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iso-iec-9899"}},[s._v("#")]),s._v(" ISO/IEC 9899")]),s._v(" "),t("p",[s._v("根据此标准的 "),t("code",[s._v("6.5.7 Bitwise shift operators")]),s._v(" 一节来看：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("对负数的"),t("code",[s._v("左移")]),s._v("属于 "),t("code",[s._v("UB")]),s._v(" 行为。")])]),s._v(" "),t("li",[t("p",[s._v("对负数的"),t("code",[s._v("右移")]),s._v("属于 "),t("code",[s._v("implementation-defined")]),s._v(" 行为。")])]),s._v(" "),t("li",[t("p",[t("em",[s._v("关于 UB 与 implementation-defined 的区别,请参阅:")])]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://stackoverflow.com/questions/2397984/undefined-unspecified-and-implementation-defined-behavior",target:"_blank",rel:"noopener noreferrer"}},[s._v("Undefined, unspecified and implementation-defined behavior"),t("OutboundLink")],1)])])]),s._v(" "),t("li",[t("p",[s._v("但是此时有一个新的问题，如果只参阅 ISO 的标准去判断 UB 行为，那么 UB 行为就有些过于"),t("strong",[s._v("广泛")]),s._v("了，所以还需要去参阅一下编译器的实现。")])])]),s._v(" "),t("h3",{attrs:{id:"microsoft-c-语言参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#microsoft-c-语言参考"}},[s._v("#")]),s._v(" Microsoft C++ 语言参考")]),s._v(" "),t("p",[s._v("根据微软的 「C++」 编译器实现，在 X86/X64 的架构下：")]),s._v(" "),t("ul",[t("li",[s._v("对负数的"),t("code",[s._v("左移")]),s._v("，如果影响到符号位，则结果是不确定的，为 UB。")]),s._v(" "),t("li",[s._v("对负数的"),t("code",[s._v("右移")]),s._v("，为implementation-defined。"),t("strong",[s._v("Microsoft C++ 编译器使用符号位填充空出的位，但是无法保证其他实现也会这样执行。")])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.open-std.org/jtc1/sc22/wg14/www/docs/n1548.pdf",target:"_blank",rel:"noopener noreferrer"}},[s._v("ISO/IEC 9899:201x"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://learn.microsoft.com/zh-cn/cpp/cpp/left-shift-and-right-shift-operators-input-and-output?view=msvc-170#right-shifts",target:"_blank",rel:"noopener noreferrer"}},[s._v("左移和右移运算符（<< 和 >>）"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/Qihoo360/safe-rules/blob/main/c-ub-list.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("附录：C 未定义行为成因列表"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);